---
layout: post
title: How we ship code
---
نسعى في أبنية إلى جعل تجربة بناء تنفيذ مشاريعنا التقنية سريعة وسلسة من خلال استخدام التقنيات وطرق تمكننا من أتمتة بناء وتطوير برامجنا بأسرع طريقة وإلغاء أي عملية يدوية ممكنة. سأذكر في هذه المدونة كيفية استخدامنا لخدمات أمازون السحابية (AWS) في بناء code pipeline لأتمتة تحديث موقع وتطبيق منصة أبنية دون الحاجة لأي تدخل يدوي. على الرغم من أن التفاصيل التي سوف أذكرها خاصة بتحديث الموقع، إلا أن طريقة عمل تحديث التطبيق مشابه إلى حد كبير لطريقة تحديث الموقع وقد نذكر طريقة تحديثنا للتطبيق في مدونة لاحقة.

## Architectural Diagram
<img src="https://blog.abneyah.com/public/img/cicd.png" alt="Abneyah">

### GitHub أو AWS CodeCommit
جميع ملفات البرمجة التي نبنيها تكون مخزنة في GitHub. على الرغم من أن أمازون للخدمات السحابية توفر خدمة مشابهة لـGitHub وهي AWS CodeCommit إلى أننا فضلنا استخدام GitHub لخبرتنا في استخدامه بالإضافة إلى عدد و نوعية المزايا التي يقدمها في مقابل AWS CodeCommit. إلا أن AWS CodeCommit يبقى من الخيارات الجيدة وله مميزاته.

## AWS CodePipeline
توفر خدمات أمازون للخدمات السحابية خدمة AWS CodePipeline والتي نستخدمها لإدارة كامل دورة عملية بناء وتحديث البرامج حيث تقوم هذه الخدمة بالتأكد من أن كامل متطلبات العمل تتم وفق المراحل (Stages) التي نحددها. تنفيذ المراحل يكون بشكل تسلسي وبالإمكان إضافة أكثر من عمل واحد في نفس المرحلة. من المزايا الرائعة التي تقدمها خدمة AWS CodePipelin دعم و (integration) لعدد من الحلول و البرامج المعروفة بخدماتها في مجال إصدار البرامج بالإضافة للخدمات أمازون نفسها في هذا المجال.

### AWS CodeBuild
يبدأ AWS CodePipeline بالعمل بواسطة webhook ترسل له بواسطة GitHub عندما نقوم بعمل بإضافات جديدة للبرامج. عند تشغيل الـ pipeline الخاص بالبرنامج الذي تم تحديثه، تقوم الخدمة بتشغيل خدمة AWS CodeBuild المسؤولة عن أتمتة بناء الأكواد. تقوم خدمة AWS CodeBuild بتشغيل Container يقوم بتحميل الأكواد الموجودة في GitHub وبنائها ثم حفظ ناتج البناء في S3 Bucket كما هو موضح في المخطط.  خطوات بناء البرنامج من خلال الأكواد تكون موضحة في ملف buildspec.yaml. بإمكانك تحديد البرامج المطلوبة لبناء البرنامج، أوامر ما قبل البناء, أثناء البناء أو بعد البناء بالإضافة لعدد كثير من خيارت بناء البرنامج.

### AWS Identity and Access Management (IAM)

لكي يتمكن أي شخص أو خدمة باستخدام خدمة أخرى يجب أن تكون له أو لها صلاحية لاستخدام الخدمة ويتم ذلك من خلال خدمة IAM. هناك نوعين أساسيين من المستخدمين الذين توفرهم IAM للأشخاص أو الخدمات لغرض استخدام خدمات AWS وهما IAM User وIAM role. IAM User نوع من المستخدمين الذي يتم إستخدامه صلاحياته بواسطة Access and Secret keys بالإضافة إلى Session Token في حال كان استخدام صلاحية الـIAM User بشكل مؤقت. IAM Role هي وظيفة بإمكان المستخدم أو الخدمة تقمصها لاستخدام الخدمات ويتم ذلك عن طريق قيام AWS بعمل Access key, Secret key, session مؤقتاً نيابة عنا لأداء الخدمة التي نرغب بتنفيذها وتعطيل المفاتيح بعد الانتهاء. يتم تحديد صلاحيات الـ IAM User أو IAM Role باستخدام IAM Policies. نقوم في أبنية بجعل AWS Codepipeline يتقمص IAM Role و صلاحيات محددة لإنجاز مهمته.